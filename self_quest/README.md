ğŸ›¡ï¸ Game Server Programming Study (C++)

ì´ í”„ë¡œì íŠ¸ëŠ” **<ìœ¤ì„±ìš°ì˜ ì—´í˜ˆ TCP/IP ì†Œì¼“ í”„ë¡œê·¸ë˜ë°>**ê³¼ **<ë°°í˜„ì§ì˜ ê²Œì„ ì„œë²„ í”„ë¡œê·¸ë˜ë° êµê³¼ì„œ>**ì˜ í•™ìŠµ ë¡œë“œë§µì„ ë”°ë¼, ì‹¤ì œ ê²Œì„ ì„œë²„ ê°œë°œì— í•„ìš”í•œ í•µì‹¬ ê¸°ìˆ ì„ ë°‘ë°”ë‹¥ë¶€í„° êµ¬í˜„í•˜ê³  ê²€ì¦í•˜ëŠ” ê³¼ì •ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

ğŸ“š Curriculum Overview

Lv.1 TCP/UDP ê¸°ì´ˆ: ì†Œì¼“ì˜ ë³¸ì§ˆê³¼ í”„ë¡œí† ì½œë³„ íŠ¹ì„± ê²€ì¦

Lv.2 I/O ë©€í‹°í”Œë ‰ì‹±: ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë‹¤ì¤‘ ì ‘ì† ì²˜ë¦¬ (Select ëª¨ë¸)

Lv.3 ë©€í‹°ìŠ¤ë ˆë“œ: ë™ê¸°í™”(Synchronization)ì™€ Race Condition í•´ê²° (ì˜ˆì •)

Lv.4 ê³ ì„±ëŠ¥ I/O: IOCP / Epoll ëª¨ë¸ êµ¬í˜„ (ì˜ˆì •)

Lv.5 ì‹¤ì „ ê²Œì„ ì„œë²„: íŒ¨í‚· ì„¤ê³„, DB ì—°ë™, ë¶„ì‚° ì²˜ë¦¬ (ì˜ˆì •)

âš”ï¸ Quest 1. TCP vs UDP ì„±ëŠ¥ ë° ì‹ ë¢°ì„± í…ŒìŠ¤íŠ¸ê¸°

ë‹¨ìˆœí•œ ë°ì´í„° ì „ì†¡ì„ ë„˜ì–´, TCPì™€ UDPì˜ ì‹¤ì œ ë™ì‘ ì°¨ì´ë¥¼ ëˆˆìœ¼ë¡œ í™•ì¸í•˜ê³ , ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì— ë”°ë¥¸ ì„±ëŠ¥ ë³€í™”ë¥¼ ë¶„ì„í•˜ëŠ” ë²¤ì¹˜ë§ˆí¬ ë„êµ¬ì…ë‹ˆë‹¤.

ğŸ”‘ Key Learnings (í•µì‹¬ ì›ë¦¬ ë° í† ë¡ )

TCPê°€ ë¡œì»¬(Localhost)ì—ì„œ ë” ë¹ ë¥¸ ì´ìœ ?

ì§ê´€ê³¼ ë°˜ëŒ€ë˜ëŠ” ê²°ê³¼: ì´ë¡ ìƒ UDPê°€ ë¹¨ë¼ì•¼ í•˜ì§€ë§Œ, ë¡œì»¬ í…ŒìŠ¤íŠ¸ì—ì„  TCPê°€ ë” ë¹ ë¥´ê²Œ ì¸¡ì •ë¨.

ì›ì¸ 1 (System Call): TCPëŠ” ëŒ€ìš©ëŸ‰ ë²„í¼ë§(4KB)ì„ í†µí•´ ì‹œìŠ¤í…œ ì½œ íšŸìˆ˜ë¥¼ ì¤„ì´ì§€ë§Œ, UDPëŠ” ì‘ì€ íŒ¨í‚·(1KB) ë‹¨ìœ„ë¡œ ë¹ˆë²ˆí•˜ê²Œ í˜¸ì¶œí•˜ì—¬ ì˜¤ë²„í—¤ë“œ ë°œìƒ.

ì›ì¸ 2 (Optimization): ë¡œì»¬ í™˜ê²½ì—ì„œ TCPëŠ” OS ë ˆë²¨ì˜ ë©”ëª¨ë¦¬ ë³µì‚¬ ìµœì í™”ë¥¼ ë°›ìŒ.

UDPê°€ ì‹¤ì œ ì¸í„°ë„·(Real World)ì—ì„œ ë” ë¹ ë¥¸ ì´ìœ ?

No ACK: TCPëŠ” í™•ì¸ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ë§Œ(RTT ì˜í–¥), UDPëŠ” ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì—°ì† ë°œì‚¬.

No Head-of-Line Blocking: ì• íŒ¨í‚·ì´ ìœ ì‹¤ë˜ì–´ë„ ë’¤ íŒ¨í‚· ì²˜ë¦¬ë¥¼ ë©ˆì¶”ì§€ ì•ŠìŒ (ì‹¤ì‹œê°„ ê²Œì„ í•„ìˆ˜).

Aggressive: í˜¼ì¡ ì œì–´(Congestion Control)ê°€ ì—†ì–´ ë„¤íŠ¸ì›Œí¬ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ëŒ€ì—­í­ì„ ì ìœ  ê°€ëŠ¥.

TCP Listen vs UDP Listen

TCPëŠ” ì—°ê²° ì§€í–¥í˜•ì´ë¼ listen()(ëŒ€ê¸°ì‹¤ ìƒì„±)ì´ í•„ìˆ˜ì§€ë§Œ, UDPëŠ” ë¹„ì—°ê²°í˜•ì´ë¼ ìš°ì²´í†µì²˜ëŸ¼ bind()ë§Œ í•˜ë©´ ì¦‰ì‹œ ìˆ˜ì‹  ê°€ëŠ¥.

ğŸ› ï¸ Implementation Details

Reliability Test: 1GB ë°ì´í„° ì „ì†¡ ì‹œ TCPì˜ ë¬´ê²°ì„± ê²€ì¦ (0 bit error).

Packet Loss Test: UDP ëŒ€ëŸ‰ ì „ì†¡ ì‹œ ì‹œí€€ìŠ¤ ë²ˆí˜¸(seq)ë¥¼ í†µí•œ ìœ ì‹¤ë¥  ê³„ì‚°.

Congestion Simulation: ì„œë²„ ì²˜ë¦¬ ì§€ì—°(usleep) ì‹œ, TCPëŠ” ì†ë„ë¥¼ ì¤„ì´ê³ (Flow Control), UDPëŠ” íŒ¨í‚·ì„ ëŒ€ëŸ‰ ìœ ì‹¤(Drop)í•¨ì„ í™•ì¸.

âš”ï¸ Quest 2. I/O Multiplexing Chat Server (The Chatter)

ìŠ¤ë ˆë“œë¥¼ ë¬´í•œì • ëŠ˜ë¦¬ëŠ” ëŒ€ì‹ , **ë‹¨ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œ(Single Thread)**ë¡œ ìˆ˜ì‹­~ìˆ˜ë°± ëª…ì˜ í´ë¼ì´ì–¸íŠ¸ë¥¼ ë™ì‹œì— ê´€ë¦¬í•˜ëŠ” Select ëª¨ë¸ ê¸°ë°˜ ì±„íŒ… ì„œë²„ì…ë‹ˆë‹¤.

ğŸ”‘ Key Learnings (í•µì‹¬ ì›ë¦¬ ë° í† ë¡ )

Blocking vs Multiplexing

Blocking(accept, recv): ë°ì´í„°ê°€ ì˜¬ ë•Œê¹Œì§€ í•˜ì—¼ì—†ì´ ê¸°ë‹¤ë¦¼. 1:1 í†µì‹ ì—ë§Œ ì í•©.

Multiplexing(select): ê´€ì œíƒ‘(OS)ì—ê²Œ "ì¤€ë¹„ëœ ì†Œì¼“ì´ ìˆë‚˜ìš”?"ë¼ê³  ë¬»ê³ , ì‹ í˜¸ê°€ ì˜¨ ì†Œì¼“ë§Œ ê³¨ë¼ì„œ ì²˜ë¦¬.

Selectì˜ ë™ì‘ ì›ë¦¬ (ë¹„íŠ¸ ë°°ì—´)

fd_setì´ë¼ëŠ” ë¹„íŠ¸ ë°°ì—´(ì¶œì„ë¶€)ì„ ì‚¬ìš©í•´ ê°ì‹œí•  ì†Œì¼“ë“¤ì„ OSì— ì „ë‹¬.

ì‚°ë°œì ìœ¼ë¡œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•´ë„, select í˜¸ì¶œ ì‹œì ì— ì»¤ë„ ë²„í¼ì— ë°ì´í„°ê°€ ìˆë‹¤ë©´ í•œ ë²ˆì— ì—¬ëŸ¬ ì†Œì¼“ì˜ ì´ë²¤íŠ¸ë¥¼ ê°ì§€ ê°€ëŠ¥.

Select ëª¨ë¸ì˜ í•œê³„ (Disadvantages)

O(N) Loop: ì–´ë–¤ ì†Œì¼“ì´ ì¤€ë¹„ëëŠ”ì§€ ì•Œê¸° ìœ„í•´ ì „ì²´(maxFd)ë¥¼ ë£¨í”„ ëŒë©° í™•ì¸í•´ì•¼ í•¨.

Data Copy: ë§¤ í˜¸ì¶œë§ˆë‹¤ fd_setì„ ìœ ì € ì˜ì—­ì—ì„œ ì»¤ë„ ì˜ì—­ìœ¼ë¡œ ë³µì‚¬í•´ì•¼ í•¨.

Limit: FD_SETSIZE(ê¸°ë³¸ 1024) ê°œìˆ˜ ì œí•œ ì¡´ì¬. -> ì´í›„ Epoll/IOCPë¡œ í•´ê²° í•„ìš”.

ğŸ› ï¸ Implementation Details

Room System: /join ëª…ë ¹ì–´ë¡œ ë°© ë¶„ë¦¬, ê°™ì€ ë°© ìœ ì €ë¼ë¦¬ë§Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸.

Heartbeat (Zombie Check):

ëœì„ ì„ ë½‘ê³  ì‚¬ë¼ì§„ ìœ ë ¹ ìœ ì €ë¥¼ ê°ì§€í•˜ê¸° ìœ„í•´ ë§ˆì§€ë§‰ í†µì‹  ì‹œê°„(lastHeartbeat) ì¶”ì .

select íƒ€ì„ì•„ì›ƒì„ í™œìš©í•´ ì£¼ê¸°ì ìœ¼ë¡œ ë¬´ì‘ë‹µ ìœ ì € ê°•ì œ ì—°ê²° ì¢…ë£Œ.

Automated Testing: Ruby/Python ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ë‹¤ì¤‘ ì ‘ì† ë° ì¢€ë¹„ í´ë¼ì´ì–¸íŠ¸ ì‹œë®¬ë ˆì´ì…˜.

ğŸš€ How to Run

Build

# C++ Server Compile
g++ -o Tester Tester.cpp -std=c++11       # Quest 1
g++ -o ChatServer ChatServer.cpp -std=c++11 # Quest 2


Run Quest 1 (Benchmark)

# Server
./Tester server tcp 12345
# Client
./Tester client tcp 127.0.0.1 12345


Run Quest 2 (Chat Server)

# Server
./ChatServer
# Test Bot (Ruby)
ruby test_server.rb
