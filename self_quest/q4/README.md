âš”ï¸ Quest Log: ê³ ì„±ëŠ¥ I/O ì—”ì§„ (The Engine Room)

ğŸ¯ í€˜ìŠ¤íŠ¸ ëª©í‘œ

Epoll/Kqueue ì´í•´: Selectì˜ í•œê³„(O(N) ë£¨í”„, fd_set ë³µì‚¬)ë¥¼ ë„˜ì–´, ì»¤ë„ì´ "ì¤€ë¹„ëœ ì†Œì¼“ë§Œ" ì•Œë ¤ì£¼ëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ I/O ëª¨ë¸ì„ êµ¬í˜„í•œë‹¤.

Edge Trigger vs Level Trigger: ë‘ ëª¨ë“œì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ê³ , ê°ê°ì˜ ì¥ë‹¨ì ê³¼ ì£¼ì˜ì ì„ ì²´í—˜í•œë‹¤.

í™•ì¥ì„± ê²€ì¦: ìˆ˜ì²œ ê°œì˜ ë™ì‹œ ì ‘ì†ì„ ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ì²˜ë¦¬í•˜ëŠ” ê³ ì„±ëŠ¥ ì„œë²„ì˜ ê¸°ë°˜ì„ ë‹¤ì§„ë‹¤.

ğŸ“œ Sub-Quest List

1ï¸âƒ£ [ì…ë¬¸] ì—”ì§„ êµì²´ (Select -> Epoll/Kqueue)

ëª©í‘œ: Q2ì˜ ì±„íŒ… ì„œë²„ë¥¼ Epoll(Linux) ë˜ëŠ” Kqueue(macOS)ë¡œ í¬íŒ…í•˜ê¸°.

Task 1-1: epoll_create() / kqueue()ë¡œ ì´ë²¤íŠ¸ ê°ì‹œì ìƒì„±.

Task 1-2: epoll_ctl() / kevent()ë¡œ ì„œë²„ ì†Œì¼“ ë“±ë¡ (EPOLLIN / EVFILT_READ).

Task 1-3: epoll_wait() / kevent() ë£¨í”„ êµ¬í˜„.

Task 1-4: ë°˜í™˜ëœ ì´ë²¤íŠ¸ ë°°ì—´ë§Œ ìˆœíšŒ (O(í™œì„± ì†Œì¼“) vs O(ì „ì²´ ì†Œì¼“)).

2ï¸âƒ£ [êµ¬í˜„] ë ˆë²¨ íŠ¸ë¦¬ê±° (Level Triggered - LT)

ëª©í‘œ: ê¸°ë³¸ ëª¨ë“œ(LT)ë¡œ Echo ì„œë²„ ì™„ì„±í•˜ê¸°.

Task 2-1: EPOLLIN ì´ë²¤íŠ¸ ë°œìƒ ì‹œ recv() í˜¸ì¶œ.

Task 2-2: recv()ë¡œ ì½ì€ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ send()ë¡œ ëŒë ¤ì£¼ê¸° (Echo).

Task 2-3: í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ(recv == 0) ì²˜ë¦¬ ë° epollì—ì„œ ì œê±°.

íŠ¹ì§•: ë²„í¼ì— ë°ì´í„°ê°€ ë‚¨ì•„ìˆìœ¼ë©´ ê³„ì† ì´ë²¤íŠ¸ ë°œìƒ (ì•ˆì „í•˜ì§€ë§Œ ë¹„íš¨ìœ¨ ê°€ëŠ¥).

3ï¸âƒ£ [ì‹¬í™”] ì—£ì§€ íŠ¸ë¦¬ê±° (Edge Triggered - ET)

ëª©í‘œ: ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ET ëª¨ë“œ ì „í™˜ ë° ì£¼ì˜ì‚¬í•­ ì²´í—˜.

Task 3-1: EPOLLET í”Œë˜ê·¸ ì¶”ê°€í•˜ì—¬ ì—£ì§€ íŠ¸ë¦¬ê±° ëª¨ë“œ í™œì„±í™”.

Task 3-2: ì†Œì¼“ì„ Non-blockingìœ¼ë¡œ ì„¤ì • (fcntl + O_NONBLOCK).

Task 3-3: recv()ë¥¼ EAGAINì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ ë°˜ë³µ í˜¸ì¶œ (í•œ ë²ˆì— ëª¨ë“  ë°ì´í„° ì½ê¸°).

Task 3-4: ET ëª¨ë“œì—ì„œ í•œ ë²ˆë§Œ ì½ê³  ëë‚´ë©´ ì–´ë–¤ ë¬¸ì œê°€ ìƒê¸°ëŠ”ì§€ í…ŒìŠ¤íŠ¸.

íŠ¹ì§•: ìƒíƒœ "ë³€í™”"ì‹œì—ë§Œ ì´ë²¤íŠ¸ ë°œìƒ. ë°˜ë“œì‹œ Non-blocking + ì™„ì „ ì†Œë¹„ í•„ìš”.

4ï¸âƒ£ [ë³´ë„ˆìŠ¤] ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ (Scalability)

ëª©í‘œ: Select vs Epoll ì„±ëŠ¥ ë¹„êµ ë° ëŒ€ê·œëª¨ ì ‘ì† í…ŒìŠ¤íŠ¸.

Task 4-1: ë™ì‹œ ì ‘ì† í´ë¼ì´ì–¸íŠ¸ 1000ê°œ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±.

Task 4-2: Q2(Select)ì™€ Q4(Epoll)ì˜ CPU ì‚¬ìš©ë¥ , ì‘ë‹µ ì‹œê°„ ë¹„êµ.

Task 4-3: ulimit -nìœ¼ë¡œ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œí•œ í™•ì¸ ë° ì¡°ì •.

ğŸ› ï¸ ê¸°ìˆ ì  í¬ì¸íŠ¸ (Why Epoll/Kqueue?)

Selectì˜ í•œê³„:
- ë§¤ í˜¸ì¶œë§ˆë‹¤ fd_setì„ ì»¤ë„ë¡œ ë³µì‚¬í•´ì•¼ í•¨
- ë°˜í™˜ í›„ ì–´ë–¤ ì†Œì¼“ì´ ì¤€ë¹„ëëŠ”ì§€ ì „ì²´ ë£¨í”„(O(N))ë¥¼ ëŒì•„ì•¼ í•¨
- FD_SETSIZE(1024) ì œí•œ

Epoll/Kqueueì˜ í•´ê²°ì±…:
- ì†Œì¼“ ë“±ë¡ì€ í•œ ë²ˆë§Œ (epoll_ctlì€ ë³€ê²½ ì‹œì—ë§Œ)
- ì»¤ë„ì´ "ì¤€ë¹„ëœ ì†Œì¼“ ëª©ë¡ë§Œ" ë°˜í™˜ -> O(í™œì„± ì†Œì¼“)
- ìˆ˜ì‹­ë§Œ ê°œì˜ ì†Œì¼“ ì²˜ë¦¬ ê°€ëŠ¥

Level vs Edge Trigger:
- LT(Level): ì½ì„ ë°ì´í„°ê°€ "ìˆìœ¼ë©´" ê³„ì† ì•Œë¦¼ (ì•ˆì „, ì´ˆë³´ì ê¶Œì¥)
- ET(Edge): ë°ì´í„°ê°€ "ë„ì°©í–ˆì„ ë•Œ" í•œ ë²ˆë§Œ ì•Œë¦¼ (ê³ ì„±ëŠ¥, ì£¼ì˜ í•„ìš”)

ğŸ“š ì°¸ê³  ìë£Œ

ìœ¤ì„±ìš° TCP/IP: Chapter 17 (Epoll ê¸°ë°˜ ì„œë²„)

ê²Œì„ ì„œë²„ êµê³¼ì„œ: Chapter 3.7 (IOCP, Epoll), Chapter 4 (ê³ ì„±ëŠ¥ ì„œë²„ ì•„í‚¤í…ì²˜)

Linux man pages: epoll(7), epoll_create(2), epoll_ctl(2), epoll_wait(2)

macOS man pages: kqueue(2), kevent(2)
